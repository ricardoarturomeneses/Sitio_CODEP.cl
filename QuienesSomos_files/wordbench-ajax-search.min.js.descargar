(function($){"use strict";$(document).ready(function(){$('.header-search--ajax .header-search__form, .lsvr-wordbench-sitemap__search--ajax .lsvr-wordbench-sitemap__search-form, .lsvr-wordbench-hero__search--ajax .lsvr-wordbench-hero__search-form').each(function(){var $form=$(this),cssClassPrefix=$form.data('css-class-prefix'),$input=$form.find('.'+cssClassPrefix+'input'),$filter=$form.find('.'+cssClassPrefix+'filter'),$langInput=$form.find('.'+cssClassPrefix+'lang-input'),resultsLimit=$form.data('results-limit'),searchQuery='',postType,postTypeArr=[],lang;$filter.find('input:checked').each(function(){postTypeArr.push($(this).val())});postType=postTypeArr.length<1?'any':postTypeArr.join();postTypeArr=[];lang=$langInput.length?$langInput.val():false;$input.on('change keyup paste',function(e){var newSearchQuery=$(this).val();if((newSearchQuery!==searchQuery)&&!(38===e.which||40===e.which||13===e.which)){searchQuery=newSearchQuery.trim();lsvrWordbenchAjaxSearchGetResults($form,postType,searchQuery,resultsLimit,lang)}});$input.on('focus',function(e){var newSearchQuery=$(this).val();if((newSearchQuery===searchQuery)&&$form.find('.'+cssClassPrefix+'results').length>0){$form.find('.'+cssClassPrefix+'results').slideDown(300)}else{searchQuery=newSearchQuery.trim();lsvrWordbenchAjaxSearchGetResults($form,postType,searchQuery,resultsLimit,lang)}});$filter.find('input[type="checkbox"]').on('change',function(){$filter.find('input:checked').each(function(){postTypeArr.push($(this).val())});postType=postTypeArr.length<1?'any':postTypeArr.join();postTypeArr=[];lsvrWordbenchAjaxSearchGetResults($form,postType,searchQuery,resultsLimit,lang)});$input.on('keydown',function(e){var $searchResults=$form.find('.'+cssClassPrefix+'results'),$active=$searchResults.find('.'+cssClassPrefix+'results-item--active');if(40===e.which){if($active.length<1||$active.filter(':last-child').length){$active.removeClass(cssClassPrefix+'results-item--active');$searchResults.find('.'+cssClassPrefix+'results-item:first-child').addClass(cssClassPrefix+'results-item--active')}else{$active.removeClass(cssClassPrefix+'results-item--active');$active.next().addClass(cssClassPrefix+'results-item--active')}e.preventDefault();e.stopPropagation()}if(38===e.which){if($active.length<1||$active.filter(':first-child').length){$active.removeClass(cssClassPrefix+'results-item--active');$searchResults.find('.'+cssClassPrefix+'results-item:last-child').addClass(cssClassPrefix+'results-item--active')}else{$active.removeClass(cssClassPrefix+'results-item--active');$active.prev().addClass(cssClassPrefix+'results-item--active')}e.preventDefault();e.stopPropagation()}if(13===e.which){if($active.length){window.location.href=$active.find('a').attr('href');e.preventDefault();e.stopPropagation()}}})});var lsvrWordbenchAjaxRequest=null;function lsvrWordbenchAjaxSearchGetResults($form,postType,searchQueryString,limit,language){var searchQuery=searchQueryString.trim(),lang=language!==false?'&lang='+language:'',cssClassPrefix=$form.data('css-class-prefix');if(searchQuery.length>1){clearTimeout($form.data('ajax-search-timer'));$form.data('ajax-search-timer',setTimeout(function(){$form.addClass(cssClassPrefix+'form--loading');$form.find('.'+cssClassPrefix+'spinner').fadeIn(150);if(null!==lsvrWordbenchAjaxRequest){lsvrWordbenchAjaxRequest.abort()}lsvrWordbenchAjaxRequest=jQuery.ajax({type:'post',url:lsvr_wordbench_ajax_search_var.url,data:'action=lsvr-wordbench-ajax-search&nonce='+lsvr_wordbench_ajax_search_var.nonce+'&post_type='+postType+'&search_query='+searchQuery+'&limit='+limit+lang,success:function(response){if(''!==response){var responseJson=false;try{responseJson=JSON.parse(response)}catch(e){console.log('Ajax Search Response: INVALID JSON')}if(responseJson){lsvrWordbenchAjaxSearchShowResults($form,responseJson)}}else{console.log('Ajax Search Response: BLANK')}$form.removeClass(cssClassPrefix+'form--loading');$form.find('.'+cssClassPrefix+'spinner').fadeOut(150)},error:function(){$form.removeClass(cssClassPrefix+'form--loading');$form.find('.'+cssClassPrefix+'spinner').fadeOut(150);console.log('Ajax Search Response: ERROR')}})},500))}}function lsvrWordbenchAjaxSearchShowResults($form,json){if(json.hasOwnProperty('status')){var cssClassPrefix=$form.data('css-class-prefix'),status=json.status,resultsTitle=$form.data('results-title')?$form.data('results-title'):'',output='';if('ok'===status&&json.hasOwnProperty('results')){$.each(json.results,function(){if(this.hasOwnProperty('post_title')&&this.hasOwnProperty('permalink')&&this.hasOwnProperty('post_type')&&this.hasOwnProperty('post_type_label')){output+='<li class="'+cssClassPrefix+'results-item">';output+='<span class="'+cssClassPrefix+'results-item-type">'+this.post_type_label+'</span>';output+='<a href="'+this.permalink+'" class="'+cssClassPrefix+'results-item-link">';output+=this.post_title;output+='</a></li>'}});output='<ul class="'+cssClassPrefix+'results-list">'+output+'</ul>';if(resultsTitle.length>0){output='<h3 class="'+cssClassPrefix+'results-title">'+resultsTitle+'</h3>'+output}if(json.hasOwnProperty('more_label')&&json.hasOwnProperty('more_link')){output+='<p class="'+cssClassPrefix+'results-more">';output+='<a href="'+json.more_link+'" class="'+cssClassPrefix+'results-more-link"><span class="'+cssClassPrefix+'results-more-link-label">'+json.more_label+'</span>';output+='<span class="'+cssClassPrefix+'results-more-link-icon" aria-hidden="true"></span></a></p>'}}else if('noresults'===status){var message=json.hasOwnProperty('message')?json.message:'';if(''!==message){output='<p class="'+cssClassPrefix+'results-message">'+message+'</p>'}}if(''!==output){if($form.find('.'+cssClassPrefix+'results').length>0){$form.find('.'+cssClassPrefix+'results').first().html(output)}else{$form.find('.'+cssClassPrefix+'panel').append('<div class="'+cssClassPrefix+'results">'+output+'</div>')}if($form.find('.'+cssClassPrefix+'results').is(':hidden')){$form.find('.'+cssClassPrefix+'results').slideDown(300)}$.event.trigger({type:'lsvrWordbenchAjaxSearchCompleted',message:'Ajax search completed.',time:new Date()})}}}})})(jQuery);